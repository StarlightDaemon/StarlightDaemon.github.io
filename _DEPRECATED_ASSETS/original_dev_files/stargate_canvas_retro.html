<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Bit-Bang Stargate</title>
    <style>
        body {
            background: #111;
            color: #aaa;
            font-family: monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        canvas {
            border: 4px solid #444;
            background: #000;
            image-rendering: pixelated;
            /* Crucial for retro look */
            box-shadow: 0 0 20px #000;
            width: 300px;
            height: 300px;
            /* Scaled visually */
        }

        .controls {
            margin-top: 20px;
            text-align: center;
        }

        button {
            padding: 10px;
            background: #333;
            color: #fff;
            border: 1px solid #555;
            cursor: pointer;
            font-family: inherit;
        }

        button:hover {
            background: #444;
        }
    </style>
</head>

<body>

    <canvas id="sgCanvas" width="100" height="100"></canvas>
    <div class="controls">
        <div id="status">SYSTEM READY</div>
        <br>
        <button onclick="dial()">DIAL ADDRESS</button>
    </div>

    <script>
        const canvas = document.getElementById('sgCanvas');
        const ctx = canvas.getContext('2d');
        const statusDiv = document.getElementById('status');

        // Retro Palette (Game Boy-ish)
        const PALETTE = {
            bg: '#0f380f',
            ring: '#306230',
            active: '#8bac0f',
            locked: '#9bbc0f',
            wormhole: '#9bbc0f'
        };

        let rotation = 0;
        let lockedChevrons = 0;
        let isDialing = false;
        let isWormholeOpen = false;
        let wormholeRadius = 0;

        function draw() {
            // Clear screen
            ctx.fillStyle = PALETTE.bg;
            ctx.fillRect(0, 0, 100, 100);

            const cx = 50;
            const cy = 50;

            // Draw Wormhole (if active)
            if (isWormholeOpen) {
                ctx.fillStyle = PALETTE.wormhole;
                if (wormholeRadius < 35) wormholeRadius += 1; // Open animation

                // Draw dithered circle
                for (let r = 0; r < wormholeRadius; r += 2) {
                    ctx.beginPath();
                    ctx.arc(cx, cy, r, 0, Math.PI * 2);
                    ctx.strokeStyle = (Math.random() > 0.5) ? PALETTE.active : PALETTE.ring;
                    ctx.stroke();
                }
            }

            // Draw Ring
            ctx.strokeStyle = PALETTE.ring;
            ctx.lineWidth = 8;
            ctx.beginPath();
            ctx.arc(cx, cy, 40, 0, Math.PI * 2);
            ctx.stroke();

            // Draw Inner Ring (Rotating)
            ctx.strokeStyle = PALETTE.active;
            ctx.lineWidth = 2;
            ctx.save();
            ctx.translate(cx, cy);
            ctx.rotate(rotation);
            ctx.beginPath();
            ctx.setLineDash([4, 4]); // Glyphs simulation
            ctx.arc(0, 0, 34, 0, Math.PI * 2);
            ctx.stroke();
            ctx.restore();

            // Draw Chevrons (7 points)
            for (let i = 0; i < 7; i++) {
                const angle = (i * (360 / 7) - 90) * (Math.PI / 180);
                const x = cx + Math.cos(angle) * 40;
                const y = cy + Math.sin(angle) * 40;

                ctx.fillStyle = (i < lockedChevrons) ? PALETTE.locked : PALETTE.bg;
                ctx.strokeStyle = PALETTE.active;

                ctx.beginPath();
                ctx.rect(x - 3, y - 3, 6, 6);
                ctx.fill();
                ctx.stroke();
            }

            // Animation Loop Logic
            if (isDialing) {
                rotation += 0.1;
            } else if (isWormholeOpen) {
                rotation += 0.02; // Slow spin when open
            }

            requestAnimationFrame(draw);
        }

        async function dial() {
            if (isDialing) return;
            isDialing = true;
            isWormholeOpen = false;
            wormholeRadius = 0;
            lockedChevrons = 0;
            statusDiv.innerText = "ESTABLISHING LOCK...";

            for (let i = 1; i <= 7; i++) {
                // Spin for a bit
                await new Promise(r => setTimeout(r, 800));
                lockedChevrons = i;
            }

            isDialing = false;
            isWormholeOpen = true;
            statusDiv.innerText = "WORMHOLE ESTABLISHED";
        }

        // Start Loop
        draw();
    </script>

</body>

</html>